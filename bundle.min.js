!function n(o,a,i){function c(t,e){if(!a[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);throw(r=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",r}r=a[t]={exports:{}},o[t][0].call(r.exports,function(e){return c(o[t][1][e]||e)},r,r.exports,n,o,a,i)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<i.length;e++)c(i[e]);return c}({1:[function(e,t,r){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=s(r);return function(e,t){{if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return u(e)}(this,n?(e=s(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var m=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(o,React.Component);var e,t,r,n=l(o);function o(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),e.keyDiff&&localStorage.setItem("gameStartTime",""),f(u(a=n.call(this,e)),"showDiff",function(){a.setState({showDiff:!0}),a.stopTimer()}),f(u(a),"saveResult",function(){var e,t,r,n,o;a.state.saved||(e=(o=a.state).color,t=o.diffColor,r=o.gameId,n=o.time,o=o.diffLocation,o={userId:a.props.userId,gameId:r,color:e,diffColor:t,time:n,diffLocation:o,host:window.location.host,updateKey:a.props.updateKey,gameTakenTime:(new Date).toISOString()},a.setState({saved:!0,recs:[].concat(i(a.state.recs),[o])}),localStorage.setItem("records",JSON.stringify(a.state.recs)),console.log(o),a.props.debug||firebase.firestore().collection("records").add(o).then(function(e){console.log("Successfully saved on REF ",e.id)}).catch(function(e){return console.log(e)}))}),a.state={gameId:_uuid(),color:"",diffColor:"",diffLocation:[],showDiff:!1,startTime:null,time:null,started:!1,wrongAns:null,gameCycle:0,saved:!1,recs:[],avgSpeed:parseInt(localStorage.getItem("avgSpeed"))},a}return e=o,(t=[{key:"componentDidMount",value:function(){this.setState({recs:localStorage.getItem("records")?JSON.parse(localStorage.getItem("records")):[]}),this.reloadColorGame()}},{key:"reloadColorGame",value:function(){this.stopTimer();for(var e,t=this.getRandomColor();(e=this.getSimularColor(t,this.props.diffRange))===t;);var r=[Math.floor(Math.random()*(this.props.size-1)),Math.floor(Math.random()*(this.props.size-1))];this.setState({diffLocation:r,diffColor:e,color:t,showDiff:!1,wrongAns:null,gameCycle:this.state.gameCycle+1,saved:!1})}},{key:"startGame",value:function(){this.reloadColorGame(),this.props.startCallback(),this.setState({started:!0}),this.startTimer(),localStorage.getItem("gameStartTime")||localStorage.setItem("gameStartTime",(new Date).toISOString())}},{key:"startTimer",value:function(){var r=this;this.setState({startTime:Date.now()}),this.timer=setInterval(function(){var e=r.props.timeLimit,t=Date.now()-r.state.startTime;(t=0<e?e-t:t)<0&&(r.showDiff(),r.clickBlock(!0)),r.setState({time:t})},1)}},{key:"stopTimer",value:function(){clearInterval(this.timer)}},{key:"getRandomColor",value:function(){for(var e="#",t=0;t<6;t++)e+=Math.floor(16*Math.random()).toString(16);return e}},{key:"getSimularColor",value:function(e,t){for(var r="#",n=Math.floor(2*Math.random()),o=0;o<3;o++){var a=parseInt(e.substr(2*o+1,2),16);o==n&&(255<(a+=.5<Math.random()?t:-t)?a-=2*t:a<0&&(a+=2*t));a=a.toString(16);r+=a.length<2?"0"+a:a}return r}},{key:"clickBlock",value:function(e){var t=this.setState.bind(this);e?(this.saveResult(),this.getPassedTime()<this.props.totalTime&&(this.reloadColorGame(),this.startTimer())):(clearTimeout(this.wrongAnsTimer),t({wrongAns:!0}),this.wrongAnsTimer=setTimeout(function(){t({wrongAns:!1})},2e3))}},{key:"calculateResult",value:function(e){var t=this,r=0,n=e.length,o=0,a=null,i=null;return e.forEach(function(e){100<e.time&&((null===i||t.props.timeLimit-e.time<i)&&(i=t.props.timeLimit-e.time),(null===a||t.props.timeLimit-e.time>a)&&(a=t.props.timeLimit-e.time),r+=t.props.timeLimit-e.time,o++)}),{successCount:o,timeSum:r,played:n,averageTime:r/o,rate:o/n,min:i,max:a}}},{key:"getPassedTime",value:function(){var e=localStorage.getItem("gameStartTime");return e?new Date-new Date(e):0}},{key:"render",value:function(){for(var r=this,e=[],t=this.state,n=t.diffLocation,o=t.color,a=t.diffColor,i=t.started,c=t.time,l=t.wrongAns,u=t.saved,s=this.getPassedTime(),f=0;f<this.props.size;f++){for(var m=[],p=0;p<this.props.size;p++)!function(e){var t=f==n[0]&&e==n[1];m.push(React.createElement("div",{className:"col text-center p-1 ",key:e,onClick:function(){r.clickBlock(t)}},React.createElement("div",{className:"rounded mx-auto h-100",style:{backgroundColor:t?a:o,opacity:r.state.showDiff&&!t?"0.3":"1"}})))}(p);e.push(React.createElement("div",{className:"row",key:f,style:{height:"100px"}},m))}t={};return s<this.props.totalTime||!u&&i||(t=this.calculateResult(this.state.recs)),React.createElement("div",null,React.createElement("div",{className:this.props.debug?"mb-1":"d-none"},React.createElement("button",{className:"btn btn-success",onClick:this.showDiff},"Show different"),React.createElement("button",{className:"btn btn-success ml-1",onClick:function(){return r.reloadColorGame()}},"Next"),React.createElement("button",{className:"btn btn-success ml-1",onClick:function(){return r.saveResult()}},"Save result")),React.createElement("div",{className:"mb-3 text-center"},React.createElement("h4",{className:"fade "+(l?"show":"")},React.createElement("span",{className:"badge badge-danger"},"不是這個唷")),React.createElement("h5",null,s<this.props.totalTime?i?0<c?React.createElement("span",{className:"badge badge-primary"},Math.floor(c/1e3),".",Math.floor(c%1e3)," sec"):React.createElement("span",{className:"badge badge-danger"},"時間到"):React.createElement("span",{className:"badge badge-success"},"遊戲準備開始"):React.createElement("span",{className:"badge badge-warning"},"遊戲結束"))),React.createElement("div",{className:!i&&s<this.props.totalTime?"text-center":"d-none"},React.createElement("button",{className:"btn btn-primary btn-lg",onClick:function(){r.startGame()}},"開始")),React.createElement("div",{className:"text-center"},s<this.props.totalTime||!u&&i?i?React.createElement("div",{className:"mx-1"},e):null:React.createElement("div",null,React.createElement("h4",null,"感謝遊玩~~~"),React.createElement("div",{className:"mt-4"},"你的平均反應速度：",React.createElement("span",{className:"badge badge-primary"},t.averageTime?Math.floor(100*t.averageTime)/100:"N/A"," 毫秒"),React.createElement("br",null),React.createElement("br",null),"你總共做了 ",React.createElement("span",{className:"badge badge-primary"},t.played)," 題",React.createElement("br",null),"你花費了最長 ",React.createElement("span",{className:"badge badge-primary"},t.max/1e3)," 秒解一題",React.createElement("br",null),"你最快只花了 ",React.createElement("span",{className:"badge badge-primary"},t.min/1e3)," 秒解一題",React.createElement("span",{className:"d-none"},"正確率：",React.createElement("span",{className:"badge badge-primary"},t.rate?Math.floor(100*t.rate)+"%":"N/A"))),this.props.canPlayMultiTime?React.createElement("button",{className:"btn btn-secondary mt-2",onClick:function(){localStorage.setItem("gameStartTime",""),location.reload()}},"再玩一次"):null)))}}])&&a(e.prototype,t),r&&a(e,r),o}();r.default=m},{}],2:[function(e,t,r){t.exports={diffRange:50,size:5,timeLimit:5e3,totalTime:6e4}},{}],3:[function(e,t,r){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f=n(e("./color_game")),m=n(e("./userInformation"));function n(e){return e&&e.__esModule?e:{default:e}}function a(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function i(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?a(Object(o),!0).forEach(function(e){var t,r;t=n,e=o[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=p(r);return function(e,t){{if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return s(e)}(this,n?(e=p(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=React.createElement,y=e("./config.json"),b=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(o,React.Component);var e,t,r,n=u(o);function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=n.call(this,e)).state={gameStarted:!1,user:firebase.auth().currentUser,loaded:!0,diffRange:y.diffRange,size:y.size,timeLimit:y.timeLimit,totalTime:y.totalTime,initialized:!1,keyDiff:!1,canPlayMultiTime:!1,updateKey:null};var r=e.setState.bind(s(e));return firebase.auth().onAuthStateChanged(function(e){var t;e&&(t=e.uid,console.log("UID",t),r({user:e}))}),e}return e=o,(t=[{key:"componentDidMount",value:function(){var r=this;remoteConfig.ensureInitialized().then(function(){return remoteConfig.fetchAndActivate()}).then(function(){console.log("Firebase Remote Config is initialized"),console.log(remoteConfig.getAll());var e,t=i(i({},r.state),{},{initialized:!0});"success"===remoteConfig.lastFetchStatus&&(e=remoteConfig.getString("updateKey")!==localStorage.getItem("updateKey"),localStorage.setItem("updateKey",remoteConfig.getString("updateKey")),t=i(i({},t),{},{timeLimit:remoteConfig.getNumber("time_limit"),diffRange:remoteConfig.getNumber("different_range"),totalTime:remoteConfig.getNumber("total_time"),canPlayMultiTime:remoteConfig.getBoolean("can_play_multiTime"),keyDiff:e,updateKey:remoteConfig.getString("updateKey")})),r.setState(t)}).catch(function(e){console.error("Firebase Remote Config failed to initialize",e)})}},{key:"render",value:function(){var e=this,t=this.state,r=t.gameStarted,n=t.user,o=t.diffRange,a=t.timeLimit,i=t.size,c=t.loaded,l=t.totalTime,u=t.keyDiff,s=t.canPlayMultiTime,t=t.updateKey;return React.createElement("div",{className:"container mt-5"},React.createElement("div",{className:r?"d-none d-md-block":""},React.createElement("h2",null,"找出圖中顏色與其他不同的格子"),r?null:React.createElement("p",null,"這個測驗只需要花你一分鐘就結束，你的每一份回答都是我們重要的依據，謝謝(⁎⁍̴̛ᴗ⁍̴̛⁎)")),c?n?React.createElement(f.default,{timeLimit:a,size:i,diffRange:o,totalTime:l,debug:debug||!1,userId:n.uid,startCallback:function(){e.setState({gameStarted:!0})},keyDiff:u,canPlayMultiTime:s,updateKey:t}):React.createElement(m.default,null):null)}}])&&c(e.prototype,t),r&&c(e,r),o}(),e=document.querySelector("#main_container");ReactDOM.render(d(b),e)},{"./color_game":1,"./config.json":2,"./userInformation":4}],4:[function(e,t,r){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach(function(e){f(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=s(r);return function(e,t){{if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return u(e)}(this,n?(e=s(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var m=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(o,React.Component);var e,t,r,n=l(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),f(u(t=n.call(this,e)),"onChange",function(e){t.setState(a(a({},t.state),{},f({},e.target.id,e.target.value)))}),f(u(t),"onSubmit",function(e){e.preventDefault(),firebase.auth().signInAnonymously().catch(function(e){var t=e.code,e=e.message;console.log(t,e)}).then(function(e){firebase.firestore().collection("users").doc(e.user.uid).set(a(a({},t.state),{},{gender:"Male"===t.state.gender?1:2})).then(function(){console.log("User information saved!!")}).catch(function(e){console.error("Error adding document: ",e)})})}),t.state={birthday:null,gender:"Male",admin:!1},t.onSubmit=t.onSubmit.bind(u(t)),t}return e=o,(t=[{key:"render",value:function(){return React.createElement("div",{className:"card border-secondary"},React.createElement("div",{className:"card-body"},React.createElement("h5",{className:"card-title"},"基本資料"),React.createElement("h6",{className:"card-subtitle mb-2 text-muted"},"填寫的資料只會用於統計，並不會用於其他用途"),React.createElement("form",{onSubmit:this.onSubmit},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"birthday"},"生日"),React.createElement("input",{required:!0,type:"date",className:"form-control",id:"birthday",onChange:this.onChange})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"gender"},"生理性別"),React.createElement("select",{required:!0,className:"form-control",defaultValue:"Male",id:"gender",onChange:this.onChange},React.createElement("option",null,"男"),React.createElement("option",null,"女"))),React.createElement("button",{className:"btn btn-primary btn-block"},"Save"))))}}])&&i(e.prototype,t),r&&i(e,r),o}();r.default=m},{}]},{},[3]);