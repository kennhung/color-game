!function a(i,c,l){function s(t,e){if(!c[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=c[t]={exports:{}};i[t][0].call(o.exports,function(e){return s(i[t][1][e]||e)},o,o.exports,a,i,c,l)}return c[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)s(l[e]);return s}({1:[function(e,t,r){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(n){return function(){var e,t=u(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var r=u(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?s(e):t}(this,e)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var m=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(r,React.Component);var t=c(r);function r(e){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),e.keyDiff&&localStorage.setItem("gameStartTime",""),f(s(c=t.call(this,e)),"showDiff",function(){c.setState({showDiff:!0}),c.stopTimer()}),f(s(c),"saveResult",function(){if(!c.state.saved){var e=c.state,t=e.color,r=e.diffColor,n=e.gameId,o=e.time,a=e.diffLocation,i={userId:c.props.userId,gameId:n,color:t,diffColor:r,time:o,diffLocation:a,host:window.location.host,updateKey:c.props.updateKey,gameTakenTime:(new Date).toISOString()};c.setState({saved:!0,recs:[].concat(l(c.state.recs),[i])}),localStorage.setItem("records",JSON.stringify(c.state.recs)),console.log(i),c.props.debug||firebase.firestore().collection("records").add(i).then(function(e){console.log("Successfully saved on REF ",e.id)}).catch(function(e){return console.log(e)})}}),c.state={gameId:_uuid(),color:"",diffColor:"",diffLocation:[],showDiff:!1,startTime:null,time:null,started:!1,wrongAns:null,gameCycle:0,saved:!1,recs:[],avgSpeed:parseInt(localStorage.getItem("avgSpeed"))},c}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"componentDidMount",value:function(){this.setState({recs:localStorage.getItem("records")?JSON.parse(localStorage.getItem("records")):[]}),this.reloadColorGame()}},{key:"reloadColorGame",value:function(){this.stopTimer();for(var e,t=this.getRandomColor();(e=this.getSimularColor(t,this.props.diffRange))===t;);var r=[Math.floor(Math.random()*(this.props.size-1)),Math.floor(Math.random()*(this.props.size-1))];this.setState({diffLocation:r,diffColor:e,color:t,showDiff:!1,wrongAns:null,gameCycle:this.state.gameCycle+1,saved:!1})}},{key:"startGame",value:function(){this.reloadColorGame(),this.props.startCallback(),this.setState({started:!0}),this.startTimer(),localStorage.getItem("gameStartTime")||localStorage.setItem("gameStartTime",(new Date).toISOString())}},{key:"startTimer",value:function(){var r=this;this.setState({startTime:Date.now()}),this.timer=setInterval(function(){var e=r.props.timeLimit,t=Date.now()-r.state.startTime;0<e&&(t=e-t),t<0&&(r.showDiff(),r.clickBlock(!0)),r.setState({time:t})},1)}},{key:"stopTimer",value:function(){clearInterval(this.timer)}},{key:"getRandomColor",value:function(){for(var e="#",t=0;t<6;t++){e+=Math.floor(16*Math.random()).toString(16)}return e}},{key:"getSimularColor",value:function(e,t){for(var r="#",n=Math.floor(2*Math.random()),o=0;o<3;o++){var a=parseInt(e.substr(2*o+1,2),16);o==n&&(255<(a+=.5<Math.random()?t:-t)?a-=2*t:a<0&&(a+=2*t));var i=a.toString(16);r+=i.length<2?"0"+i:i}return r}},{key:"clickBlock",value:function(e){var t=this.setState.bind(this);e?(this.saveResult(),this.getPassedTime()<this.props.totalTime&&(this.reloadColorGame(),this.startTimer())):(clearTimeout(this.wrongAnsTimer),t({wrongAns:!0}),this.wrongAnsTimer=setTimeout(function(){t({wrongAns:!1})},2e3))}},{key:"calculateResult",value:function(e){var t=this,r=0,n=e.length,o=0,a=null,i=null;return e.forEach(function(e){100<e.time&&((null===i||t.props.timeLimit-e.time<i)&&(i=t.props.timeLimit-e.time),(null===a||t.props.timeLimit-e.time>a)&&(a=t.props.timeLimit-e.time),r+=t.props.timeLimit-e.time,o++)}),{successCount:o,timeSum:r,played:n,averageTime:r/o,rate:o/n,min:i,max:a}}},{key:"getPassedTime",value:function(){var e=localStorage.getItem("gameStartTime");return e?new Date-new Date(e):0}},{key:"render",value:function(){for(var r=this,e=[],t=this.state,n=t.diffLocation,o=t.color,a=t.diffColor,i=t.started,c=t.time,l=t.wrongAns,s=t.saved,u=this.getPassedTime(),f=0;f<this.props.size;f++){for(var m=[],p=function(e){var t=f==n[0]&&e==n[1];m.push(React.createElement("div",{className:"col text-center p-1 ",key:e,onClick:function(){r.clickBlock(t)}},React.createElement("div",{className:"rounded mx-auto h-100",style:{backgroundColor:t?a:o,opacity:r.state.showDiff&&!t?"0.3":"1"}})))},d=0;d<this.props.size;d++)p(d);e.push(React.createElement("div",{className:"row",key:f,style:{height:"100px"}},m))}var y={};return u<this.props.totalTime||!s&&i||(y=this.calculateResult(this.state.recs)),React.createElement("div",null,React.createElement("div",{className:this.props.debug?"mb-1":"d-none"},React.createElement("button",{className:"btn btn-success",onClick:this.showDiff},"Show different"),React.createElement("button",{className:"btn btn-success ml-1",onClick:function(){return r.reloadColorGame()}},"Next"),React.createElement("button",{className:"btn btn-success ml-1",onClick:function(){return r.saveResult()}},"Save result")),React.createElement("div",{className:"mb-3 text-center"},React.createElement("h4",{className:"fade "+(l?"show":"")},React.createElement("span",{className:"badge badge-danger"},"不是這個唷")),React.createElement("h5",null,u<this.props.totalTime?i?0<c?React.createElement("span",{className:"badge badge-primary"},Math.floor(c/1e3),".",Math.floor(c%1e3)," sec"):React.createElement("span",{className:"badge badge-danger"},"時間到"):React.createElement("span",{className:"badge badge-success"},"遊戲準備開始"):React.createElement("span",{className:"badge badge-warning"},"遊戲結束"))),React.createElement("div",{className:!i&&u<this.props.totalTime?"text-center":"d-none"},React.createElement("button",{className:"btn btn-primary btn-lg",onClick:function(){r.startGame()}},"開始")),React.createElement("div",{className:"text-center"},u<this.props.totalTime||!s&&i?i?React.createElement("div",{className:"mx-1"},e):null:React.createElement("div",null,React.createElement("h4",null,"感謝遊玩~~~"),React.createElement("div",{className:"mt-4"},"你的平均反應速度：",React.createElement("span",{className:"badge badge-primary"},y.averageTime?Math.floor(100*y.averageTime)/100:"N/A"," 毫秒"),React.createElement("br",null),React.createElement("br",null),"你總共做了 ",React.createElement("span",{className:"badge badge-primary"},y.played)," 題",React.createElement("br",null),"你花費了最長 ",React.createElement("span",{className:"badge badge-primary"},y.max/1e3)," 秒解一題",React.createElement("br",null),"你最快只花了 ",React.createElement("span",{className:"badge badge-primary"},y.min/1e3)," 秒解一題",React.createElement("span",{className:"d-none"},"正確率：",React.createElement("span",{className:"badge badge-primary"},y.rate?Math.floor(100*y.rate)+"%":"N/A"))),this.props.canPlayMultiTime?React.createElement("button",{className:"btn btn-secondary mt-2",onClick:function(){localStorage.setItem("gameStartTime",""),location.reload()}},"再玩一次"):null)))}}]),r}();r.default=m},{}],2:[function(e,t,r){t.exports={diffRange:50,size:5,timeLimit:5e3,totalTime:6e4}},{}],3:[function(e,t,r){"use strict";var m=n(e("./color_game")),p=n(e("./userInformation"));function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach(function(e){c(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(n){return function(){var e,t=d(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var r=d(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?f(e):t}(this,e)}}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=React.createElement,b=e("./config.json"),g=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(o,React.Component);var n=u(o);function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).state={gameStarted:!1,user:firebase.auth().currentUser,loaded:!0,diffRange:b.diffRange,size:b.size,timeLimit:b.timeLimit,totalTime:b.totalTime,initialized:!1,keyDiff:!1,canPlayMultiTime:!1,updateKey:null};var r=t.setState.bind(f(t));return firebase.auth().onAuthStateChanged(function(e){if(e){var t=e.uid;console.log("UID",t),r({user:e})}}),t}return function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(o,[{key:"componentDidMount",value:function(){var r=this;remoteConfig.ensureInitialized().then(function(){return remoteConfig.fetchAndActivate()}).then(function(){console.log("Firebase Remote Config is initialized"),console.log(remoteConfig.getAll());var e=i({},r.state,{initialized:!0});if("success"===remoteConfig.lastFetchStatus){var t=remoteConfig.getString("updateKey")!==localStorage.getItem("updateKey");localStorage.setItem("updateKey",remoteConfig.getString("updateKey")),e=i({},e,{timeLimit:remoteConfig.getNumber("time_limit"),diffRange:remoteConfig.getNumber("different_range"),totalTime:remoteConfig.getNumber("total_time"),canPlayMultiTime:remoteConfig.getBoolean("can_play_multiTime"),keyDiff:t,updateKey:remoteConfig.getString("updateKey")})}r.setState(e)}).catch(function(e){console.error("Firebase Remote Config failed to initialize",e)})}},{key:"render",value:function(){var e=this,t=this.state,r=t.gameStarted,n=t.user,o=t.diffRange,a=t.timeLimit,i=t.size,c=t.loaded,l=t.totalTime,s=t.keyDiff,u=t.canPlayMultiTime,f=t.updateKey;return React.createElement("div",{className:"container mt-5"},React.createElement("div",{className:r?"d-none d-md-block":""},React.createElement("h2",null,"找出圖中顏色與其他不同的格子"),r?null:React.createElement("p",null,"這個測驗只需要花你一分鐘就結束，你的每一份回答都是我們重要的依據，謝謝(⁎⁍̴̛ᴗ⁍̴̛⁎)")),c?n?React.createElement(m.default,{timeLimit:a,size:i,diffRange:o,totalTime:l,debug:debug||!1,userId:n.uid,startCallback:function(){e.setState({gameStarted:!0})},keyDiff:s,canPlayMultiTime:u,updateKey:f}):React.createElement(p.default,null):null)}}]),o}(),h=document.querySelector("#main_container");ReactDOM.render(y(g),h)},{"./color_game":1,"./config.json":2,"./userInformation":4}],4:[function(e,t,r){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach(function(e){f(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(n){return function(){var e,t=u(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var r=u(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?s(e):t}(this,e)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var m=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,React.Component);var r=l(n);function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),f(s(t=r.call(this,e)),"onChange",function(e){t.setState(a({},t.state,f({},e.target.id,e.target.value)))}),f(s(t),"onSubmit",function(e){e.preventDefault(),firebase.auth().signInAnonymously().catch(function(e){var t=e.code,r=e.message;console.log(t,r)}).then(function(e){firebase.firestore().collection("users").doc(e.user.uid).set(a({},t.state,{gender:"Male"===t.state.gender?1:2})).then(function(){console.log("User information saved!!")}).catch(function(e){console.error("Error adding document: ",e)})})}),t.state={birthday:null,gender:"Male",admin:!1},t.onSubmit=t.onSubmit.bind(s(t)),t}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(n,[{key:"render",value:function(){return React.createElement("div",{className:"card border-secondary"},React.createElement("div",{className:"card-body"},React.createElement("h5",{className:"card-title"},"基本資料"),React.createElement("h6",{className:"card-subtitle mb-2 text-muted"},"填寫的資料只會用於統計，並不會用於其他用途"),React.createElement("form",{onSubmit:this.onSubmit},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"birthday"},"生日"),React.createElement("input",{required:!0,type:"date",className:"form-control",id:"birthday",onChange:this.onChange})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"gender"},"生理性別"),React.createElement("select",{required:!0,className:"form-control",defaultValue:"Male",id:"gender",onChange:this.onChange},React.createElement("option",null,"男"),React.createElement("option",null,"女"))),React.createElement("button",{className:"btn btn-primary btn-block"},"Save"))))}}]),n}();r.default=m},{}]},{},[3]);